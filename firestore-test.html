<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Firestore Test - APEX Executive</title>
    <style>
        body { padding: 20px; font-family: monospace; background: #1a1a2e; color: #eee; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .info { color: #60a5fa; }
        button { background: #C6A87C; color: #1a1a2e; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; font-weight: bold; }
        button:hover { background: #b09870; }
        #log { background: #0d0d1a; padding: 15px; border-radius: 8px; max-height: 500px; overflow-y: auto; }
        h1 { color: #C6A87C; }
    </style>
</head>
<body>
    <h1>Firestore Direct Test</h1>
    <p class="info">Diese Seite testet den direkten Zugriff auf Firestore Collections</p>

    <div style="margin: 20px 0;">
        <button onclick="testCoaches()">Test Coaches Collection</button>
        <button onclick="testSettings()">Test Settings Collection</button>
        <button onclick="testAboutImage()">Test About Image</button>
        <button onclick="uploadTestData()">Upload Test Data (Admin)</button>
    </div>

    <div id="log"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBZ970mA7-2pJzhbxyFjjmzO97YKZhrSmU",
            authDomain: "apex-executive.firebaseapp.com",
            projectId: "apex-executive",
            storageBucket: "apex-executive.firebasestorage.app",
            messagingSenderId: "525553082138",
            appId: "1:525553082138:web:84d1437b2e150f5fb316a3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const logEl = document.getElementById('log');

        function log(msg, type = 'info') {
            const p = document.createElement('p');
            p.className = type;
            p.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logEl.appendChild(p);
            logEl.scrollTop = logEl.scrollHeight;
            console.log(msg);
        }

        log('Firebase initialized', 'success');
        log('Project: apex-executive', 'info');

        // Monitor auth state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                log(`Logged in as: ${user.email}`, 'success');
            } else {
                log('Not logged in (anonymous access)', 'info');
            }
        });

        window.testCoaches = async () => {
            log('--- Testing COACHES collection ---', 'info');
            try {
                const snap = await getDocs(collection(db, 'coaches'));
                log(`SUCCESS: Got ${snap.docs.length} coaches`, 'success');
                snap.docs.forEach(d => {
                    log(`  - ${d.id}: ${d.data().name || 'unnamed'}`, 'info');
                });
                if (snap.docs.length === 0) {
                    log('Collection exists but is EMPTY - need to add data!', 'error');
                }
            } catch (e) {
                log(`ERROR: ${e.code} - ${e.message}`, 'error');
            }
        };

        window.testSettings = async () => {
            log('--- Testing SETTINGS collection ---', 'info');
            try {
                const snap = await getDocs(collection(db, 'settings'));
                log(`SUCCESS: Got ${snap.docs.length} settings documents`, 'success');
                snap.docs.forEach(d => {
                    log(`  - ${d.id}`, 'info');
                });
                if (snap.docs.length === 0) {
                    log('Collection exists but is EMPTY - need to add data!', 'error');
                }
            } catch (e) {
                log(`ERROR: ${e.code} - ${e.message}`, 'error');
            }
        };

        window.testAboutImage = async () => {
            log('--- Testing settings/about document ---', 'info');
            try {
                const docRef = doc(db, 'settings', 'about');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    log('SUCCESS: About document exists', 'success');
                    log(`  imageUrl: ${data.imageUrl ? 'present' : 'MISSING'}`, data.imageUrl ? 'success' : 'error');
                    if (data.imageUrl) {
                        log(`  URL: ${data.imageUrl.substring(0, 60)}...`, 'info');
                    }
                } else {
                    log('Document settings/about does NOT EXIST', 'error');
                }
            } catch (e) {
                log(`ERROR: ${e.code} - ${e.message}`, 'error');
            }
        };

        window.uploadTestData = async () => {
            log('--- Attempting to upload test data ---', 'info');
            log('NOTE: This requires admin login first!', 'info');

            const email = prompt('Admin Email:');
            const password = prompt('Admin Password:');

            if (!email || !password) {
                log('Cancelled - no credentials provided', 'error');
                return;
            }

            try {
                log('Signing in...', 'info');
                await signInWithEmailAndPassword(auth, email, password);
                log('Signed in successfully!', 'success');

                // Upload about settings
                log('Uploading settings/about...', 'info');
                await setDoc(doc(db, 'settings', 'about'), {
                    imageUrl: 'https://images.unsplash.com/photo-1507679799987-c73779587ccf?w=800',
                    title: 'APEX Executive',
                    description: 'Premium Executive Services'
                });
                log('settings/about uploaded!', 'success');

                // Upload mentoring settings
                log('Uploading settings/mentoring...', 'info');
                await setDoc(doc(db, 'settings', 'mentoring'), {
                    slotsText: 'Nur noch 3 Plätze verfügbar'
                });
                log('settings/mentoring uploaded!', 'success');

                // Upload sample coaches
                const coaches = [
                    { name: "Dr. Markus T.", role: "CIO @ DAX30", industry: "tech", price: 350, image: "https://randomuser.me/api/portraits/men/32.jpg", bio: "15 Jahre Erfahrung in globalen IT-Transformationen.", expertise: ["Strategy", "IT"], stats: "20y Exp" },
                    { name: "Sarah L.", role: "VP Sales", industry: "tech", price: 350, image: "https://randomuser.me/api/portraits/women/44.jpg", bio: "Sales Expert für SaaS Scale-Ups.", expertise: ["Sales", "Growth"], stats: "100M Revenue" },
                    { name: "Johannes B.", role: "CFO", industry: "finance", price: 400, image: "https://randomuser.me/api/portraits/men/85.jpg", bio: "Fokus auf M&A und Corporate Finance.", expertise: ["M&A", "Finance"], stats: "15 Deals" }
                ];

                for (const coach of coaches) {
                    log(`Uploading coach: ${coach.name}...`, 'info');
                    await setDoc(doc(db, 'coaches', coach.name.replace(/[^a-zA-Z]/g, '_').toLowerCase()), coach);
                    log(`Coach ${coach.name} uploaded!`, 'success');
                }

                log('=== ALL DATA UPLOADED SUCCESSFULLY ===', 'success');

            } catch (e) {
                log(`ERROR: ${e.code} - ${e.message}`, 'error');
            }
        };

        log('Ready - click buttons to test', 'info');
    </script>
</body>
</html>
