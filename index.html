<!DOCTYPE html>
<html lang="de" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX Executive | Live Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { dark: '#0B1120', gold: '#C6A87C', light: '#F3F4F6', accent: '#1E293B' }
                    },
                    fontFamily: { serif: ['"Cinzel"', 'serif'], sans: ['"Lato"', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .gold-gradient { background: linear-gradient(135deg, #C6A87C 0%, #E2D1B3 50%, #C6A87C 100%); }
        .hero-pattern { background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #C6A87C; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .faq-content { transition: max-height 0.4s ease-out; max-height: 0; overflow: hidden; }
        .faq-open .faq-content { max-height: 500px; }
        .faq-open i { transform: rotate(180deg); }
    </style>
</head>
<body class="bg-brand-light text-brand-dark font-sans antialiased relative flex flex-col min-h-screen">

    <!-- GLOBAL NAV -->
    <nav class="bg-brand-dark text-white sticky top-0 z-50 shadow-xl border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-24 items-center">
                <div class="flex items-center space-x-3 group cursor-pointer" onclick="app.navigateTo('home')">
                    <div class="relative w-10 h-10 flex items-center justify-center border border-brand-gold rounded-sm transform group-hover:rotate-45 transition duration-500">
                        <i class="fas fa-mountain text-brand-gold text-lg transform group-hover:-rotate-45 transition duration-500"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-serif text-2xl tracking-widest leading-none text-white">APEX</span>
                        <span class="text-[0.65rem] uppercase tracking-[0.3em] text-brand-gold">Executive</span>
                    </div>
                </div>

                <div id="nav-links" class="hidden md:flex space-x-8 text-xs uppercase tracking-widest font-bold text-gray-400">
                    <button onclick="app.navigateTo('home'); app.scrollToSection('cv-packages')" class="hover:text-brand-gold transition py-2">CV-Manufaktur</button>
                    <button onclick="app.navigateTo('home'); app.scrollToSection('coaches')" class="hover:text-brand-gold transition py-2">Mentoren</button>
                    <button onclick="app.navigateTo('journal')" class="hover:text-brand-gold transition py-2">Insights</button>
                    <button onclick="app.navigateTo('about')" class="hover:text-brand-gold transition py-2">Über uns</button>
                </div>
                
                <div class="flex items-center space-x-6">
                    <button onclick="app.toggleCart()" class="relative text-white hover:text-brand-gold transition group flex items-center gap-2">
                        <i class="fas fa-briefcase text-lg"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-brand-gold text-brand-dark text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center hidden shadow-md">0</span>
                    </button>
                    
                    <div class="hidden md:block">
                        <button id="nav-login-btn" onclick="app.navigateTo('login')" class="border border-brand-gold/30 text-brand-gold px-6 py-2 rounded-sm font-bold text-xs uppercase hover:bg-brand-gold hover:text-brand-dark transition duration-300">Login</button>
                        <div id="nav-user-profile" class="hidden flex items-center gap-3 cursor-pointer" onclick="app.navigateTo('dashboard')">
                            <div class="text-right hidden lg:block"><span class="block text-xs text-white font-bold" id="user-name-display">User</span><span class="block text-[10px] text-brand-gold uppercase tracking-wider">Dashboard</span></div>
                            <div class="w-10 h-10 rounded-full border-2 border-brand-gold bg-gray-700 flex items-center justify-center text-brand-gold font-serif text-lg" id="user-initial">U</div>
                        </div>
                    </div>
                    <button onclick="app.toggleMobileMenu()" class="md:hidden text-white text-2xl"><i class="fas fa-bars"></i></button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden absolute top-24 left-0 w-full bg-brand-dark border-b border-white/10 shadow-xl py-6 px-4 flex-col space-y-4 z-40">
            <button onclick="app.navigateTo('home'); app.toggleMobileMenu()" class="text-left text-white font-serif text-lg border-b border-white/5 pb-2">Home</button>
            <button onclick="app.navigateTo('journal'); app.toggleMobileMenu()" class="text-left text-white font-serif text-lg border-b border-white/5 pb-2">Insights</button>
            <button onclick="app.navigateTo('about'); app.toggleMobileMenu()" class="text-left text-white font-serif text-lg border-b border-white/5 pb-2">Über uns</button>
            <button onclick="app.navigateTo('login'); app.toggleMobileMenu()" class="text-left text-brand-gold font-bold uppercase tracking-widest text-xs pt-2">Login / Register</button>
        </div>
    </nav>

    <!-- CONTENT -->
    <div id="view-home" class="fade-in">
        <header class="bg-brand-dark text-white relative overflow-hidden hero-pattern">
            <div class="absolute inset-0 bg-gradient-to-br from-brand-dark via-brand-dark/95 to-brand-accent/90 z-10"></div>
            <div class="relative z-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 md:py-32 grid md:grid-cols-12 gap-12 items-center">
                <div class="md:col-span-7">
                    <span class="text-brand-gold uppercase tracking-widest text-xs font-bold block mb-4 border-l-2 border-brand-gold pl-4">Live Platform</span>
                    <h1 class="font-serif text-4xl md:text-6xl leading-tight mb-6">Karriere <br> neu <span class="text-transparent bg-clip-text gold-gradient">definieren</span>.</h1>
                    <p class="text-gray-300 text-lg mb-10 font-light leading-relaxed max-w-xl">Wir demokratisieren Executive-Qualität. Egal ob Sie ins C-Level aufsteigen oder Ihre Karriere erst starten.</p>
                    <div class="flex flex-col sm:flex-row gap-5">
                        <button onclick="app.scrollToSection('cv-packages')" class="gold-gradient text-brand-dark font-bold py-4 px-10 rounded-sm hover:shadow-lg transition text-center uppercase tracking-wider text-sm">Zu den Paketen</button>
                        <button onclick="app.scrollToSection('coaches')" class="group flex items-center text-white py-4 px-8 rounded-sm hover:text-brand-gold transition text-center uppercase tracking-wider text-sm"><span>Mentoren</span><i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition"></i></button>
                    </div>
                </div>
            </div>
        </header>

        <section id="cv-packages" class="py-24 bg-white relative">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16"><h2 class="font-serif text-4xl text-brand-dark mb-4">Unterlagen für jede Stufe</h2></div>
                <div class="grid md:grid-cols-3 gap-8">
                    <!-- Paket 1 -->
                    <div class="border border-gray-200 p-8 rounded-sm hover:shadow-2xl transition cursor-pointer relative" onclick="app.openPackageDetail('young')">
                        <h3 class="font-serif text-xl text-brand-dark mb-2">Young Professional</h3>
                        <div class="text-3xl font-serif text-brand-dark mb-6">€249</div>
                        <ul class="space-y-4 mb-8 text-sm text-gray-600"><li><i class="fas fa-check text-brand-gold mr-2"></i> Profi-CV</li><li><i class="fas fa-check text-brand-gold mr-2"></i> Fokus Potenzial</li></ul>
                        <button onclick="event.stopPropagation(); app.addToCart('Young Professional CV', 249)" class="w-full border border-brand-dark text-brand-dark py-3 uppercase text-xs font-bold hover:bg-brand-dark hover:text-white transition">Auswählen</button>
                    </div>
                    <!-- Paket 2 -->
                    <div class="border-2 border-brand-gold p-8 rounded-sm shadow-xl relative transform md:-translate-y-4" onclick="app.openPackageDetail('senior')">
                        <div class="absolute top-0 right-0 bg-brand-gold text-brand-dark text-[10px] font-bold px-3 py-1 uppercase">Popular</div>
                        <h3 class="font-serif text-xl text-brand-dark mb-2">Senior Professional</h3>
                        <div class="text-3xl font-serif text-brand-dark mb-6">€490</div>
                        <ul class="space-y-4 mb-8 text-sm text-gray-600"><li><i class="fas fa-check text-brand-gold mr-2"></i> USP Erarbeitung</li><li><i class="fas fa-check text-brand-gold mr-2"></i> LinkedIn Update</li></ul>
                        <button onclick="event.stopPropagation(); app.addToCart('Senior Professional CV', 490)" class="w-full bg-brand-gold text-brand-dark py-3 uppercase text-xs font-bold hover:shadow-lg transition">Auswählen</button>
                    </div>
                    <!-- Paket 3 -->
                    <div class="bg-brand-dark text-white p-8 rounded-sm relative hover:shadow-2xl transition" onclick="app.openPackageDetail('exec')">
                        <h3 class="font-serif text-xl mb-2">Executive C-Suite</h3>
                        <div class="text-3xl font-serif mb-6">€990</div>
                        <ul class="space-y-4 mb-8 text-sm text-gray-400"><li><i class="fas fa-check text-brand-gold mr-2"></i> Executive Rebranding</li><li><i class="fas fa-check text-brand-gold mr-2"></i> Headhunter Intro</li></ul>
                        <button onclick="event.stopPropagation(); app.addToCart('Executive C-Suite CV', 990)" class="w-full border border-white text-white py-3 uppercase text-xs font-bold hover:bg-white hover:text-brand-dark transition">Auswählen</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="coaches" class="py-24 bg-brand-light border-t border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="mb-12 text-center"><h2 class="font-serif text-4xl text-brand-dark mb-4">Executive Sparring</h2><p class="text-gray-500">Echte Entscheider. Echte Erfahrung.</p></div>
                <div class="flex justify-end mb-8"><select id="industry-filter" onchange="app.filterCoaches()" class="bg-white border border-gray-300 px-4 py-2 rounded-sm text-sm"><option value="all">Alle Branchen</option><option value="tech">Tech</option><option value="finance">Finance</option><option value="automotive">Automotive</option></select></div>
                <div id="coach-grid" class="grid md:grid-cols-3 gap-8"></div>
            </div>
        </section>

        <!-- FAQ, Process, etc. (kept concise for length, logic intact) -->
        <section id="faq" class="py-24 bg-white border-t"><div class="max-w-4xl mx-auto px-4"><h2 class="text-center font-serif text-3xl mb-12">FAQ</h2><div class="space-y-4" id="faq-container"></div></div></section>
    </div>

    <!-- VIEW 2: AUTH (LOGIN & REGISTER) -->
    <div id="view-login" class="hidden min-h-[80vh] flex items-center justify-center bg-brand-light fade-in">
        <div class="bg-white p-10 rounded-sm shadow-2xl w-full max-w-md border-t-4 border-brand-gold relative">
            <div class="flex justify-center mb-8 gap-6 border-b border-gray-100 pb-4">
                <button onclick="app.toggleAuthMode('login')" id="tab-login" class="font-bold text-brand-dark border-b-2 border-brand-dark pb-1">Login</button>
                <button onclick="app.toggleAuthMode('register')" id="tab-register" class="text-gray-400 pb-1">Registrieren</button>
            </div>
            
            <form onsubmit="return false;" class="space-y-6">
                <div><label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">E-Mail</label><input type="email" id="auth-email" class="w-full bg-gray-50 border border-gray-300 p-3 outline-none focus:border-brand-gold"></div>
                <div><label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Passwort</label><input type="password" id="auth-password" class="w-full bg-gray-50 border border-gray-300 p-3 outline-none focus:border-brand-gold"></div>
                
                <button type="button" onclick="app.handleAuth()" class="w-full gold-gradient text-brand-dark font-bold py-3 uppercase text-xs hover:shadow-lg transition" id="auth-submit-btn">Anmelden</button>
            </form>
            <p id="auth-error" class="text-red-500 text-xs mt-4 text-center hidden"></p>
        </div>
    </div>

    <!-- VIEW 3: DASHBOARD (REAL UPLOAD) -->
    <div id="view-dashboard" class="hidden fade-in flex-grow bg-gray-50">
        <div class="bg-brand-dark text-white py-12">
            <div class="max-w-7xl mx-auto px-4 flex justify-between items-end">
                <div><h1 class="font-serif text-3xl mb-1">Willkommen, <span id="dash-username">User</span></h1><p class="text-brand-gold text-xs uppercase tracking-widest">Premium Member</p></div>
                <button onclick="app.handleLogout()" class="text-xs border border-white/20 px-4 py-2 hover:bg-white hover:text-black transition">Abmelden</button>
            </div>
        </div>
        <div class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-8">
                <!-- Orders -->
                <div class="bg-white p-6 rounded-sm shadow-sm border border-gray-200">
                    <h3 class="font-bold text-brand-dark mb-4">Aktive Aufträge</h3>
                    <div id="dashboard-orders" class="text-sm text-gray-500">Keine aktiven Aufträge.</div>
                </div>
                <!-- Upload -->
                <div class="bg-white p-6 rounded-sm shadow-sm border border-gray-200">
                    <h3 class="font-bold text-brand-dark mb-4">Secure Data Vault</h3>
                    <div class="border-2 border-dashed border-gray-300 p-8 text-center bg-gray-50 relative">
                        <input type="file" id="file-upload" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="app.handleFileUpload(this)">
                        <div id="upload-ui-default"><i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i><p class="text-sm">Dokumente hier ablegen (PDF)</p></div>
                        <div id="upload-ui-loading" class="hidden"><div class="loader"></div><p class="text-xs mt-2">Uploading to Secure Storage...</p></div>
                    </div>
                    <div id="file-list" class="mt-4 space-y-2"></div>
                </div>
            </div>
            <!-- Sidebar -->
            <div class="bg-brand-dark text-white p-6 rounded-sm shadow-lg">
                <h3 class="font-bold mb-4">Support</h3>
                <p class="text-sm text-gray-400 mb-4">Ihr persönlicher Concierge steht bereit.</p>
                <button class="w-full bg-brand-gold text-black text-xs font-bold py-2 uppercase">Kontakt aufnehmen</button>
            </div>
        </div>
    </div>

    <!-- OTHER VIEWS (Journal, About, Details, Coach Detail) -->
    <div id="view-journal" class="hidden fade-in min-h-screen bg-gray-50"><div class="py-20 text-center"><h1 class="font-serif text-3xl">Insights</h1><div id="journal-grid" class="max-w-6xl mx-auto px-4 grid md:grid-cols-3 gap-6 mt-10"></div></div></div>
    <div id="view-about" class="hidden fade-in min-h-screen bg-white"><div class="py-20 max-w-4xl mx-auto px-4 text-center"><h1 class="font-serif text-3xl mb-6">Über uns</h1><p class="text-gray-600">Gegründet von einem CIO, um echte Brücken zu bauen.</p></div></div>
    <div id="view-package-details" class="hidden fade-in min-h-screen bg-white"><div class="py-20 text-center"><h1 class="font-serif text-3xl">Vergleich</h1><button onclick="app.navigateTo('home')" class="mt-6 underline">Zurück</button></div></div>
    <div id="view-coach-detail" class="hidden fade-in min-h-screen bg-white"><div class="py-20 max-w-4xl mx-auto px-4" id="coach-detail-content"></div></div>
    <div id="view-article-detail" class="hidden fade-in min-h-screen bg-white"><div class="py-20 max-w-3xl mx-auto px-4" id="article-content-area"></div></div>

    <!-- Footer -->
    <footer class="bg-white pt-10 pb-6 border-t mt-auto text-center text-xs text-gray-500">&copy; 2024 APEX Executive GmbH</footer>

    <!-- Modals -->
    <div id="cart-overlay" class="fixed inset-0 z-[60] hidden"><div class="absolute inset-0 bg-black/50" onclick="app.toggleCart()"></div><div id="cart-sidebar" class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col"><div class="p-6 border-b flex justify-between"><h3 class="font-serif text-xl">Portfolio</h3><button onclick="app.toggleCart()">X</button></div><div id="cart-items" class="flex-grow p-6"></div><div class="p-6 border-t"><span id="cart-total" class="font-serif text-2xl block mb-4">€0</span><button onclick="app.checkout()" class="w-full bg-brand-dark text-white py-4 font-bold">Kostenpflichtig bestellen</button></div></div></div>
    <div id="toast" class="fixed bottom-5 right-5 bg-brand-dark text-white px-6 py-4 rounded shadow-lg transform translate-y-20 transition-transform duration-300 z-[70]">Hinzugefügt</div>

    <!-- APP LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

        // --- KONFIGURATION (HIER IHRE DATEN EINFÜGEN) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBZ970mA7-2pJzhbxyFjjmzO97YKZhrSmU", // <-- HIER ERSETZEN
            authDomain: "apex-executive.firebaseapp.com",
            projectId: "apex-executive",
            storageBucket: "apex-executive.firebasestorage.app",
            messagingSenderId: "525553082138",
            appId: "1:525553082138:web:84d1437b2e150f5fb316a3"
        };

        // --- CORE SYSTEM ---
        let auth, db, storage;
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            storage = getStorage(app);
            console.log("System Online");
        } catch(e) { console.error("Config missing"); }

        window.app = {
            state: { cart: [], isLoginMode: true, user: null },
            
            // --- DATA (Fallback if DB empty) ---
            coaches: [
                { id: "101", name: "Dr. Markus T.", role: "CIO @ DAX30", industry: "tech", price: 350, image: "https://randomuser.me/api/portraits/men/32.jpg", bio: "20 Jahre Erfahrung in globalen IT-Transformationen.", expertise: ["Strategy", "Leadership"], stats: "500M+ Budget" },
                { id: "102", name: "Sarah L.", role: "VP Sales", industry: "tech", price: 350, image: "https://randomuser.me/api/portraits/women/44.jpg", bio: "Expertin für SaaS Scaling und Go-to-Market.", expertise: ["Sales", "Growth"], stats: "IPO Exp." }
            ],
            articles: [
                { id: "a1", cat: "Leadership", title: "Boardroom Dynamics", preview: "Die ungeschriebenen Gesetze.", image: "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?auto=format&fit=crop&q=80&w=800", content: "<p>Content...</p>" },
                { id: "a2", cat: "Career", title: "Der 200k CV", preview: "Was Headhunter wirklich suchen.", image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?auto=format&fit=crop&q=80&w=800", content: "<p>Content...</p>" }
            ],

            // --- NAVIGATION ---
            navigateTo: (viewId) => {
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById('view-' + viewId)?.classList.remove('hidden');
                
                const navLinks = document.getElementById('nav-links');
                if(['home','about','journal'].includes(viewId)) {
                    navLinks.classList.remove('hidden'); 
                    navLinks.classList.add('md:flex');
                } else {
                    navLinks.classList.add('hidden');
                    navLinks.classList.remove('md:flex');
                }
                window.scrollTo(0,0);
            },
            scrollToSection: (id) => {
                if(document.getElementById('view-home').classList.contains('hidden')) {
                    app.navigateTo('home');
                    setTimeout(() => document.getElementById(id)?.scrollIntoView({behavior:'smooth'}), 100);
                } else { document.getElementById(id)?.scrollIntoView({behavior:'smooth'}); }
            },
            toggleMobileMenu: () => {
                const menu = document.getElementById('mobile-menu');
                menu.classList.toggle('hidden'); menu.classList.toggle('flex');
            },

            // --- AUTHENTICATION ---
            toggleAuthMode: (mode) => {
                app.state.isLoginMode = (mode === 'login');
                document.getElementById('tab-login').classList.toggle('border-brand-dark', app.state.isLoginMode);
                document.getElementById('tab-login').classList.toggle('text-gray-400', !app.state.isLoginMode);
                document.getElementById('tab-register').classList.toggle('border-brand-dark', !app.state.isLoginMode);
                document.getElementById('tab-register').classList.toggle('text-gray-400', app.state.isLoginMode);
                document.getElementById('auth-submit-btn').innerText = app.state.isLoginMode ? "Anmelden" : "Kostenlos Registrieren";
            },

            handleAuth: async () => {
                const email = document.getElementById('auth-email').value;
                const password = document.getElementById('auth-password').value;
                const errorDiv = document.getElementById('auth-error');
                
                if(!auth) { // Simulation
                    app.state.user = { email: email, uid: "sim-user" };
                    app.updateAuthUI();
                    app.navigateTo('dashboard');
                    return;
                }

                try {
                    if (app.state.isLoginMode) {
                        await signInWithEmailAndPassword(auth, email, password);
                    } else {
                        await createUserWithEmailAndPassword(auth, email, password);
                    }
                } catch (error) {
                    errorDiv.innerText = error.message;
                    errorDiv.classList.remove('hidden');
                }
            },

            handleLogout: async () => {
                if(auth) await signOut(auth);
                app.state.user = null;
                app.updateAuthUI();
                app.navigateTo('home');
            },

            updateAuthUI: () => {
                if (app.state.user) {
                    document.getElementById('nav-login-btn').classList.add('hidden');
                    document.getElementById('nav-user-profile').classList.remove('hidden');
                    document.getElementById('dash-username').innerText = app.state.user.email.split('@')[0];
                    document.getElementById('user-name-display').innerText = app.state.user.email.substring(0, 8) + '...';
                    document.getElementById('user-initial').innerText = app.state.user.email[0].toUpperCase();
                } else {
                    document.getElementById('nav-login-btn').classList.remove('hidden');
                    document.getElementById('nav-user-profile').classList.add('hidden');
                }
            },

            // --- DATABASE & DATA ---
            fetchCollection: async (colName) => {
                if(!db) return [];
                try {
                    const snap = await getDocs(collection(db, colName));
                    return snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
                } catch(e) { console.log("DB Error", e); return []; }
            },

            initData: async () => {
                const dbCoaches = await app.fetchCollection('coaches');
                if(dbCoaches.length > 0) app.coaches = dbCoaches;
                app.renderCoaches();

                const dbArticles = await app.fetchCollection('articles');
                if(dbArticles.length > 0) app.articles = dbArticles;
                app.renderArticles();
            },

            // --- CART & ORDERS ---
            toggleCart: () => {
                const el = document.getElementById('cart-overlay');
                const sidebar = document.getElementById('cart-sidebar');
                if(el.classList.contains('hidden')) {
                    el.classList.remove('hidden');
                    setTimeout(() => sidebar.classList.remove('translate-x-full'), 10);
                } else {
                    sidebar.classList.add('translate-x-full');
                    setTimeout(() => el.classList.add('hidden'), 300);
                }
            },
            addToCart: (title, price) => {
                app.state.cart.push({ title, price, id: Date.now() });
                app.updateCartUI();
                const t = document.getElementById('toast');
                t.classList.remove('translate-y-20');
                setTimeout(() => t.classList.add('translate-y-20'), 2000);
            },
            removeFromCart: (id) => {
                app.state.cart = app.state.cart.filter(x => x.id !== id);
                app.updateCartUI();
            },
            updateCartUI: () => {
                document.getElementById('cart-count').innerText = app.state.cart.length;
                document.getElementById('cart-count').classList.toggle('hidden', app.state.cart.length === 0);
                const list = document.getElementById('cart-items');
                const total = app.state.cart.reduce((s,i) => s + i.price, 0);
                list.innerHTML = app.state.cart.length ? app.state.cart.map(i => `<div class="flex justify-between p-4 border-b"><span>${i.title}</span><button onclick="app.removeFromCart(${i.id})" class="text-red-500">X</button></div>`).join('') : '<p class="text-center text-gray-500 mt-10">Leer</p>';
                document.getElementById('cart-total').innerText = '€' + total;
            },
            checkout: async () => {
                if(app.state.cart.length === 0) return;
                
                if(!app.state.user) {
                    alert("Bitte erst einloggen.");
                    app.toggleCart();
                    app.navigateTo('login');
                    return;
                }

                // Save Order to DB
                if(db) {
                    try {
                        await addDoc(collection(db, "orders"), {
                            userId: app.state.user.uid,
                            items: app.state.cart,
                            total: app.state.cart.reduce((s,i) => s + i.price, 0),
                            date: new Date()
                        });
                    } catch(e) { console.error("Order save failed", e); }
                }

                app.toggleCart();
                alert("Vielen Dank! Ihre Bestellung wurde gespeichert. Wir melden uns.");
                app.state.cart = [];
                app.updateCartUI();
            },

            // --- FILE UPLOAD ---
            handleFileUpload: async (input) => {
                const file = input.files[0];
                if(!file) return;

                const uiDefault = document.getElementById('upload-ui-default');
                const uiLoading = document.getElementById('upload-ui-loading');
                const fileList = document.getElementById('file-list');

                uiDefault.classList.add('hidden');
                uiLoading.classList.remove('hidden');

                try {
                    if (storage && app.state.user) {
                        const storageRef = ref(storage, `users/${app.state.user.uid}/${file.name}`);
                        await uploadBytes(storageRef, file);
                    } else {
                        await new Promise(r => setTimeout(r, 1500)); // Simulation
                    }
                    
                    // Success UI
                    fileList.innerHTML += `<div class="flex justify-between items-center p-3 bg-green-50 text-xs rounded border border-green-200"><span class="flex items-center gap-2"><i class="fas fa-check-circle text-green-600"></i> ${file.name}</span><span class="text-green-700 font-bold">Gesichert</span></div>`;
                } catch(e) {
                    alert("Upload Fehler: " + e.message);
                } finally {
                    uiDefault.classList.remove('hidden');
                    uiLoading.classList.add('hidden');
                }
            },

            // --- RENDERING ---
            renderCoaches: () => {
                const grid = document.getElementById('coach-grid');
                if(!grid) return;
                const filter = document.getElementById('industry-filter')?.value || 'all';
                const list = filter === 'all' ? app.coaches : app.coaches.filter(c => c.industry === filter);
                
                grid.innerHTML = list.map(c => `
                    <div class="bg-white p-6 border rounded-sm hover:shadow-lg transition cursor-pointer" onclick="app.openCoachDetail('${c.id}')">
                        <div class="flex items-center mb-4"><img src="${c.image}" class="w-16 h-16 rounded-full border-2 border-brand-gold mr-4 object-cover"><div><h4 class="font-bold">${c.name}</h4><p class="text-xs text-brand-gold uppercase">${c.role}</p></div></div>
                        <div class="mt-4 pt-4 border-t flex justify-between items-center">
                            <span class="text-xs font-bold text-gray-400">€${c.price}/h</span>
                            <div class="flex gap-2">
                                <button onclick="event.stopPropagation(); app.openCoachDetail('${c.id}')" class="text-gray-400 hover:text-brand-dark"><i class="far fa-eye"></i></button>
                                <button onclick="event.stopPropagation(); app.addToCart('Session: ${c.name}', ${c.price})" class="text-brand-dark hover:text-brand-gold"><i class="fas fa-plus-circle text-lg"></i></button>
                            </div>
                        </div>
                    </div>`).join('');
            },

            openCoachDetail: (id) => {
                const c = app.coaches.find(x => x.id == id);
                if(!c) return;
                const expertise = Array.isArray(c.expertise) ? c.expertise : (c.expertise ? [c.expertise] : ['Leadership']);
                
                document.getElementById('coach-detail-content').innerHTML = `
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="w-full md:w-1/3"><img src="${c.image}" class="w-full rounded border-4 border-white shadow-lg"></div>
                        <div class="w-full md:w-2/3">
                            <h1 class="font-serif text-3xl mb-2">${c.name}</h1>
                            <p class="text-brand-gold uppercase font-bold text-xs mb-6">${c.role}</p>
                            <p class="text-gray-600 mb-6 leading-relaxed">${c.bio || 'Keine Bio verfügbar.'}</p>
                            <div class="mb-6"><h4 class="font-bold text-xs uppercase mb-2">Expertise</h4><div class="flex flex-wrap gap-2">${expertise.map(e => `<span class="bg-brand-dark text-white px-2 py-1 text-[10px] uppercase rounded">${e}</span>`).join('')}</div></div>
                            <button onclick="app.addToCart('Session: ${c.name}', ${c.price}); app.navigateTo('home')" class="bg-brand-gold text-brand-dark font-bold py-3 px-8 uppercase text-xs hover:shadow-lg">Buchen</button>
                        </div>
                    </div>`;
                app.navigateTo('coach-detail');
            },

            renderArticles: () => {
                const grid = document.getElementById('journal-grid');
                if(!grid) return;
                grid.innerHTML = app.articles.map(a => `
                    <div class="bg-white border rounded-sm overflow-hidden hover:shadow-xl transition cursor-pointer" onclick="app.openArticle('${a.id}')">
                        <div class="h-48 bg-gray-200 relative"><img src="${a.image}" class="w-full h-full object-cover"><span class="absolute top-2 left-2 bg-brand-gold text-brand-dark text-[10px] font-bold px-2 py-1 uppercase">${a.cat}</span></div>
                        <div class="p-6"><h3 class="font-serif text-lg font-bold mb-2">${a.title}</h3><p class="text-sm text-gray-500 line-clamp-3">${a.preview}</p></div>
                    </div>`).join('');
            },

            openArticle: (id) => {
                const a = app.articles.find(x => x.id == id);
                if(!a) return;
                document.getElementById('article-content-area').innerHTML = `<span class="text-brand-gold font-bold uppercase text-xs">${a.cat}</span><h1 class="font-serif text-3xl my-4">${a.title}</h1><img src="${a.image}" class="w-full h-64 object-cover mb-8 rounded"><div class="prose text-gray-700">${a.content}</div>`;
                app.navigateTo('article-detail');
            },
            
            // Helpers
            toggleFaq: (id) => { document.getElementById(id).parentElement.classList.toggle('faq-open'); },
            openPackageDetail: (type) => { app.navigateTo('package-details'); },
            filterCoaches: () => { app.renderCoaches(); }
        };

        // --- INIT ---
        if(auth) {
            onAuthStateChanged(auth, (user) => {
                app.state.user = user;
                app.updateAuthUI();
                if(user && !document.getElementById('view-login').classList.contains('hidden')) app.navigateTo('dashboard');
            });
        }
        document.addEventListener('DOMContentLoaded', () => { app.initData(); });
        
        // FAQ Initial Population (Static for simplicity in this view)
        const faqContainer = document.getElementById('faq-container');
        if(faqContainer) {
            // ... (Add dynamic FAQ rendering if needed, currently static in HTML)
        }
    </script>
</body>
</html>